<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ballard bread lab · late night pickup</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", sans-serif;
      background-color: #0f0f10;
      color: #f5f5f5;
      margin: 0;
      padding: 2rem;
      line-height: 1.4;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      background-color: #1a1a1d;
      border: 1px solid #2a2a2f;
      border-radius: 1rem;
      padding: 1.5rem 1.5rem 2rem;
      max-width: 380px;
      width: 100%;
      box-shadow: 0 30px 80px rgba(0,0,0,0.8);
    }

    h1 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      margin: 0 0 .4rem;
    }

    .subtitle {
      font-size: .9rem;
      color: #a5a5a5;
      margin: 0 0 1rem;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 1rem;
      font-size: .95rem;
    }

    .item-name {
      color: #fff;
      font-weight: 500;
      max-width: 70%;
    }

    .item-price {
      color: #fff;
      font-weight: 600;
    }

    label {
      font-size: .8rem;
      color: #ccc;
      display: block;
      margin-bottom: .4rem;
    }

    input[type="email"] {
      width: 100%;
      background-color: #0f0f10;
      color: #fff;
      border: 1px solid #3a3a42;
      border-radius: .5rem;
      padding: .6rem .75rem;
      font-size: .9rem;
      outline: none;
    }

    input[type="email"]:focus {
      border-color: #888;
    }

    .btn-checkout {
      appearance: none;
      border: 0;
      border-radius: .6rem;
      width: 100%;
      margin-top: 1rem;
      padding: .8rem 1rem;
      font-size: .95rem;
      font-weight: 600;
      line-height: 1.2;
      background: #fff;
      color: #000;
      cursor: pointer;
    }

    .btn-checkout:disabled {
      background: #444;
      color: #888;
      cursor: not-allowed;
    }

    .note {
      margin-top: 1rem;
      font-size: .75rem;
      line-height: 1.4;
      color: #7a7a7a;
    }

    .error {
      margin-top: .75rem;
      font-size: .8rem;
      color: #ff6b6b;
      min-height: 1em;
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>ballard bread lab · late night pickup</h1>
    <p class="subtitle">
      fresh loaf, delivery / hand-off only. no storefront.
    </p>

    <div class="price-row">
      <div class="item-name">1× house loaf / midnight batch</div>
      <div class="item-price">$20.00</div>
    </div>

    <div style="margin-bottom:1rem;">
      <label for="email">Contact email (receipt + pickup window)</label>
      <input id="email" type="email" placeholder="you@example.com" />
    </div>

    <button id="checkoutBtn" class="btn-checkout">Pay with card</button>

    <div id="errorMsg" class="error"></div>

    <p class="note">
      after payment we email you, confirm timing, and meet up discreet
      (ballard / magnolia late night). no walk-ups.
    </p>
  </main>

  <script>
    async function startCheckout() {
      const btn = document.getElementById('checkoutBtn');
      const emailInput = document.getElementById('email');
      const errorBox = document.getElementById('errorMsg');

      errorBox.textContent = '';
      btn.disabled = true;

      const email = emailInput.value.trim();

      // Single fixed product for now
      const cart = [
        {
          name: "ballard bread lab · late night pickup",
          price: 20.00
        }
      ];

      try {
        const res = await fetch('/api/create-checkout', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            items: cart,
            email
          })
        });

        const data = await res.json();

        if (data.url) {
          // Send buyer to Stripe Checkout
          window.location.href = data.url;
        } else {
          errorBox.textContent =
            (data.error && data.error.message) || 'checkout error';
          btn.disabled = false;
        }
      } catch (err) {
        errorBox.textContent = err.message || 'network error';
        btn.disabled = false;
      }
    }

    document
      .getElementById('checkoutBtn')
      .addEventListener('click', startCheckout);
  </script>
</body>
</html>
